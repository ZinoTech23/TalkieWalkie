<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI-Tactical PTT</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-zinc-900 text-green-500 font-mono flex flex-col items-center justify-center min-h-screen p-4">

    <div class="border-2 border-green-500 p-6 rounded-lg w-full max-w-md bg-black shadow-[0_0_15px_rgba(34,197,94,0.3)]">
        <h1 class="text-2xl font-bold mb-4 text-center tracking-widest uppercase">Comm Unit-01</h1>
        
        <div class="mb-4 p-2 bg-zinc-800 rounded border border-zinc-700">
            <p class="text-xs text-zinc-400">YOUR FREQUENCY (ID):</p>
            <p id="my-id" class="text-lg font-bold">Connecting...</p>
        </div>

        <input type="text" id="peer-id" placeholder="ENTER TARGET ID" class="w-full p-3 mb-4 bg-zinc-900 border border-green-800 text-green-400 focus:outline-none focus:border-green-400">
        
        <button id="call-btn" class="w-full py-3 bg-green-900 hover:bg-green-700 text-white font-bold rounded mb-4 transition-all">CONNECT TO TARGET</button>

        <div class="flex flex-col items-center">
            <button id="ptt-button" class="w-32 h-32 rounded-full border-4 border-red-600 bg-red-900 shadow-lg active:scale-95 active:bg-red-600 flex items-center justify-center text-white font-black text-xl select-none">
                PUSH
            </button>
            <p class="mt-4 text-xs animate-pulse" id="status">STANDBY</p>
        </div>
    </div>

   <script>
    const peer = new Peer();
    let localStream = null;

    // Load Sound Effects
    const startSound = new Audio('https://gfxsounds.com/wp-content/uploads/2023/10/Walkie-talkie-turn-on-push-button-beep-3.mp3');
    const endSound = new Audio('https://raw.githubusercontent.com/polyfloyd/quindar/master/audio/quindar-tone-low.mp3');

    peer.on('open', (id) => {
        document.getElementById('my-id').innerText = id;
    });

    peer.on('call', (call) => {
        navigator.mediaDevices.getUserMedia({ audio: true }).then((stream) => {
            localStream = stream;
            localStream.getAudioTracks()[0].enabled = false;
            call.answer(stream);
            call.on('stream', (remoteStream) => {
                const audio = new Audio();
                audio.srcObject = remoteStream;
                audio.play();
            });
        });
    });

    document.getElementById('call-btn').onclick = () => {
        const targetId = document.getElementById('peer-id').value;
        navigator.mediaDevices.getUserMedia({ audio: true }).then((stream) => {
            localStream = stream;
            localStream.getAudioTracks()[0].enabled = false;
            const call = peer.call(targetId, stream);
            call.on('stream', (remoteStream) => {
                const audio = new Audio();
                audio.srcObject = remoteStream;
                audio.play();
            });
            document.getElementById('status').innerText = "LINK ESTABLISHED";
        });
    };

    // PTT Logic with Sound Effects
    const pttBtn = document.getElementById('ptt-button');
    const statusText = document.getElementById('status');

    const startTalking = () => {
        if (localStream) {
            startSound.currentTime = 0;
            startSound.play(); // Play "Click"
            localStream.getAudioTracks()[0].enabled = true;
            statusText.innerText = "TRANSMITTING...";
            statusText.classList.add('text-red-500');
        }
    };

    const stopTalking = () => {
        if (localStream) {
            localStream.getAudioTracks()[0].enabled = false;
            endSound.currentTime = 0;
            endSound.play(); // Play "Beep"
            statusText.innerText = "LINK ESTABLISHED";
            statusText.classList.remove('text-red-500');
        }
    };

    // Listeners for both Desktop and Mobile
    pttBtn.addEventListener('mousedown', startTalking);
    pttBtn.addEventListener('mouseup', stopTalking);
    pttBtn.addEventListener('touchstart', (e) => { e.preventDefault(); startTalking(); });
    pttBtn.addEventListener('touchend', (e) => { e.preventDefault(); stopTalking(); });
</script>
</body>
</html>
